{
  "metadata": {
    "id": "ppf-broker-complete",
    "name": "PPF Broker All Loan Types",
    "version": "1.0.0",
    "description": "Multi-flow form supporting DSCR and RTL loan types with dynamic borrower arrays"
  },
  "flowConfig": {
    "type": "selection",
    "navigation": "stepped",
    "selectionStep": {
      "stepId": "loan-type-selection",
      "fieldName": "loanTypeName"
    }
  },
  "flowSelection": {
    "step": "loan-type-selection",
    "field": "loanTypeName"
  },
  "steps": [
    {
      "id": "loan-type-selection",
      "name": "Choose Loan Program",
      "description": "Select the type of loan you want to apply for",
      "order": 1,
      "required": true,
      "fields": [
        {
          "id": "loanTypeName",
          "type": "radio",
          "name": "loanTypeName",
          "label": "Select Loan Type",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12
          },
          "options": [
            {
              "value": "debt-service-coverage-ratio",
              "label": "DSCR (Debt Service Coverage Ratio)",
              "description": "Investment property loan based on rental income"
            },
            {
              "value": "residential-transition-loan",
              "label": "RTL (Residential Transition Loan)",
              "description": "Fix & flip, fix & hold, bridge loans"
            }
          ]
        }
      ]
    },
    {
      "id": "qualifying-info",
      "name": "Qualifying Information",
      "description": "Basic qualifying information for pricing",
      "order": 2,
      "required": true,
      "fields": [
        {
          "id": "loanPurpose",
          "type": "dropdown",
          "name": "loanPurpose",
          "label": "Loan Purpose",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "options": [
            {
              "value": "purchase",
              "label": "Purchase"
            },
            {
              "value": "refinance_rate_and_term",
              "label": "Refinance Rate-And-Term"
            },
            {
              "value": "refinance_cashout",
              "label": "Refinance Cashout"
            }
          ]
        },
        {
          "id": "property_type",
          "type": "dropdown",
          "name": "property_type",
          "label": "Property Type",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "options": [
            {
              "value": "single_family_residence",
              "label": "Single Family Residence"
            },
            {
              "value": "2_4_unit",
              "label": "2-4 Units"
            },
            {
              "value": "condominium",
              "label": "Condominium"
            },
            {
              "value": "townhome",
              "label": "Townhome"
            }
          ]
        },
        {
          "id": "property_state",
          "type": "dropdown",
          "name": "property_state",
          "label": "Property State",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "options": [
            {
              "value": "CA",
              "label": "California"
            },
            {
              "value": "NY",
              "label": "New York"
            },
            {
              "value": "TX",
              "label": "Texas"
            },
            {
              "value": "FL",
              "label": "Florida"
            }
          ]
        },
        {
          "id": "estimatedCreditScore",
          "type": "dropdown",
          "name": "estimatedCreditScore",
          "label": "Estimated Credit Score",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "options": [
            {
              "value": "760+",
              "label": "760+"
            },
            {
              "value": "740-759",
              "label": "740-759"
            },
            {
              "value": "720-739",
              "label": "720-739"
            },
            {
              "value": "700-719",
              "label": "700-719"
            },
            {
              "value": "680-699",
              "label": "680-699"
            }
          ]
        },
        {
          "id": "property_value",
          "type": "text",
          "name": "property_value",
          "label": "Property Value",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "formType": "amount",
          "placeholder": "500000"
        },
        {
          "id": "citizenship",
          "type": "dropdown",
          "name": "citizenship",
          "label": "Citizenship",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "options": [
            {
              "value": "us_citizen",
              "label": "U.S. Citizen"
            },
            {
              "value": "permanent_resident_alien",
              "label": "Permanent Resident Alien"
            },
            {
              "value": "non_permanent_resident_alien",
              "label": "Non-Permanent Resident Alien"
            }
          ]
        }
      ]
    },
    {
      "id": "dscr-details",
      "name": "DSCR Property Details",
      "description": "Rental property income and expense details",
      "order": 3,
      "required": true,
      "conditions": [
        {
          "===": [
            {
              "var": "loanTypeName"
            },
            "debt-service-coverage-ratio"
          ]
        }
      ],
      "fields": [
        {
          "id": "rentalUse",
          "type": "dropdown",
          "name": "rentalUse",
          "label": "Rental Use",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "options": [
            {
              "value": "long_term",
              "label": "Long Term"
            },
            {
              "value": "short_term",
              "label": "Short Term"
            }
          ]
        },
        {
          "id": "numberOfUnits",
          "type": "dropdown",
          "name": "numberOfUnits",
          "label": "Number of Units",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "options": [
            {
              "value": 1,
              "label": "1"
            },
            {
              "value": 2,
              "label": "2"
            },
            {
              "value": 3,
              "label": "3"
            },
            {
              "value": 4,
              "label": "4"
            }
          ]
        },
        {
          "id": "monthlyPropertyTaxes",
          "type": "text",
          "name": "monthlyPropertyTaxes",
          "label": "Monthly Property Taxes",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "formType": "amount"
        },
        {
          "id": "monthlyInsurance",
          "type": "text",
          "name": "monthlyInsurance",
          "label": "Monthly Insurance",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "formType": "amount"
        },
        {
          "id": "unit1MonthlyRent",
          "type": "text",
          "name": "unit1MonthlyRent",
          "label": "Unit 1 Monthly Rent",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "formType": "amount",
          "conditions": [
            {
              ">=": [
                {
                  "var": "numberOfUnits"
                },
                1
              ]
            }
          ]
        },
        {
          "id": "unit2MonthlyRent",
          "type": "text",
          "name": "unit2MonthlyRent",
          "label": "Unit 2 Monthly Rent",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "formType": "amount",
          "conditions": [
            {
              ">=": [
                {
                  "var": "numberOfUnits"
                },
                2
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "rtl-details",
      "name": "RTL Project Details",
      "description": "Rehab and construction project details",
      "order": 3,
      "required": true,
      "conditions": [
        {
          "===": [
            {
              "var": "loanTypeName"
            },
            "residential-transition-loan"
          ]
        }
      ],
      "fields": [
        {
          "id": "loanType",
          "type": "dropdown",
          "name": "loanType",
          "label": "Loan Type",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "options": [
            {
              "value": "fix_and_flip",
              "label": "Fix and Flip"
            },
            {
              "value": "fix_and_hold",
              "label": "Fix and Hold"
            },
            {
              "value": "bridge_loan",
              "label": "Bridge Loan"
            },
            {
              "value": "ground_up_construction",
              "label": "Ground Up Construction"
            }
          ]
        },
        {
          "id": "projectsCompleted",
          "type": "dropdown",
          "name": "projectsCompleted",
          "label": "Projects Completed in Past 36 Months",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "options": [
            {
              "value": "0",
              "label": "0"
            },
            {
              "value": "1",
              "label": "1"
            },
            {
              "value": "2",
              "label": "2"
            },
            {
              "value": "3",
              "label": "3"
            },
            {
              "value": "10+",
              "label": "10+"
            }
          ]
        },
        {
          "id": "rehabAmount",
          "type": "text",
          "name": "rehabAmount",
          "label": "Rehab Amount",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "formType": "amount",
          "conditions": [
            {
              "or": [
                {
                  "===": [
                    {
                      "var": "loanType"
                    },
                    "fix_and_flip"
                  ]
                },
                {
                  "===": [
                    {
                      "var": "loanType"
                    },
                    "fix_and_hold"
                  ]
                }
              ]
            }
          ]
        },
        {
          "id": "afterRepairValue",
          "type": "text",
          "name": "afterRepairValue",
          "label": "After Repair Value (ARV)",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "formType": "amount",
          "conditions": [
            {
              "or": [
                {
                  "===": [
                    {
                      "var": "loanType"
                    },
                    "fix_and_flip"
                  ]
                },
                {
                  "===": [
                    {
                      "var": "loanType"
                    },
                    "fix_and_hold"
                  ]
                },
                {
                  "===": [
                    {
                      "var": "loanType"
                    },
                    "ground_up_construction"
                  ]
                }
              ]
            }
          ]
        },
        {
          "id": "constructionBudget",
          "type": "text",
          "name": "constructionBudget",
          "label": "Construction Budget",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "formType": "amount",
          "conditions": [
            {
              "===": [
                {
                  "var": "loanType"
                },
                "ground_up_construction"
              ]
            }
          ]
        },
        {
          "id": "availableLiquidity",
          "type": "text",
          "name": "availableLiquidity",
          "label": "Available Liquidity",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "formType": "amount"
        }
      ]
    },
    {
      "id": "borrower-selection",
      "name": "Application Type",
      "description": "Select application type and number of borrowers",
      "order": 4,
      "required": true,
      "fields": [
        {
          "id": "application_type",
          "type": "radio",
          "name": "application_type",
          "label": "Application Type",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12
          },
          "options": [
            {
              "value": "individual",
              "label": "Individual"
            },
            {
              "value": "joint",
              "label": "Joint"
            }
          ]
        },
        {
          "id": "numberOfBorrowers",
          "type": "dropdown",
          "name": "numberOfBorrowers",
          "label": "Number of Borrowers",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "defaultValue": 2,
          "arrayController": "borrowers",
          "conditions": [
            {
              "===": [
                {
                  "var": "application_type"
                },
                "joint"
              ]
            }
          ],
          "options": [
            {
              "value": 2,
              "label": "2"
            },
            {
              "value": 3,
              "label": "3"
            },
            {
              "value": 4,
              "label": "4"
            }
          ]
        }
      ]
    }
  ],
  "arrayTemplates": {
    "borrowers": {
      "minCount": 1,
      "maxCount": 4,
      "defaultCount": 1,
      "countField": "numberOfBorrowers",
      "fieldTemplate": [
        {
          "id": "first_name",
          "type": "text",
          "label": "First Name",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "Please enter the name"
            },
            {
              "rule": "minLength",
              "value": 2,
              "message": "Name must be at least 2 characters"
            },
            {
              "rule": "maxLength",
              "value": 50,
              "message": "Name cannot exceed 50 characters"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "arrayIndex": true
        },
        {
          "id": "last_name",
          "type": "text",
          "label": "Last Name",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "Please enter the name"
            },
            {
              "rule": "minLength",
              "value": 2,
              "message": "Name must be at least 2 characters"
            },
            {
              "rule": "maxLength",
              "value": 50,
              "message": "Name cannot exceed 50 characters"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "arrayIndex": true
        },
        {
          "id": "email",
          "type": "email",
          "label": "Email Address",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "Please enter your email address"
            },
            {
              "rule": "email",
              "message": "Please enter a valid email address"
            }
          ],
          "grid": {
            "xs": 12
          },
          "arrayIndex": true
        },
        {
          "id": "phone",
          "type": "phone",
          "label": "Phone Number",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "Please enter your phone number"
            },
            {
              "rule": "phoneUS",
              "message": "Please enter a valid US phone number"
            }
          ],
          "grid": {
            "xs": 12
          },
          "arrayIndex": true
        },
        {
          "id": "ssn",
          "type": "password",
          "label": "SSN (9 digits)",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "arrayIndex": true
        },
        {
          "id": "date_of_birth",
          "type": "date",
          "label": "Date of Birth",
          "required": true,
          "validation": [
            {
              "rule": "required",
              "message": "This field is required"
            }
          ],
          "grid": {
            "xs": 12,
            "sm": 6
          },
          "arrayIndex": true
        }
      ]
    }
  }
}
